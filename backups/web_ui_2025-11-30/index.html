      <style>
        html, body {
          height: 100%;
          margin: 0;
          background: #181a1b;
          color: #e0e0e0;
          font-family: 'Segoe UI', 'Consolas', 'monospace', sans-serif;
        }
        #header {
          width: 100vw;
          height: 48px;
          background: #23272e;
          color: #baff80;
          display: flex;
          align-items: center;
          justify-content: flex-start;
          box-shadow: 0 2px 8px #000a;
          font-size: 1.1em;
          font-family: 'Segoe UI', 'Consolas', 'monospace', sans-serif;
          z-index: 3000;
          position: fixed;
          top: 0;
          left: 0;
          right: 0;
          border-bottom: 1.5px solid #181a1b;
          user-select: none;
        }
        .menu-btn {
          background: none;
          border: none;
          color: #baff80;
          font-weight: bold;
          font-size: 1em;
          margin: 0 18px 0 0;
          padding: 8px 16px;
          border-radius: 6px;
          cursor: pointer;
          transition: background 0.2s, color 0.2s;
        }
        .menu-btn:hover {
          background: #39ff1420;
          color: #39ff14;
        }
        #blocklyDiv {
          flex: 1 1 auto;
          min-height: 100px;
          background: #181a1b !important;
          border-radius: 8px;
          box-shadow: 0 0 32px #000a;
          z-index: 1;
        }
        .blocklyMainBackground {
          fill: #181a1b !important;
        }
        .blocklySvg {
          background: #181a1b !important;
        }
        .blocklyFlyoutBackground {
          fill: #23272e !important;
          stroke: #333 !important;
        }
        .blocklyToolboxDiv {
          background: #23272e !important;
          color: #baff80 !important;
          border-right: 2px solid #181a1b !important;
        }
        .blocklyTreeLabel {
          color: #baff80 !important;
        }
        .blocklyTrash, .blocklyZoom, .blocklyScrollbarHorizontal, .blocklyScrollbarVertical {
          display: none !important;
        }
      </style>
      <style>
        /* Sidebar styles */
        #sidebar {
          background: #23272e;
          border-right: 2px solid #181a1b;
          box-shadow: 2px 0 12px #000a;
          min-width: 220px;
          max-width: 320px;
          width: 260px;
          display: flex;
          flex-direction: column;
          z-index: 2500;
          position: fixed;
          top: 48px;
          left: 0;
          height: calc(100vh - 48px);
          overflow: hidden;
        }
        #sidebarCategories {
          list-style: none;
          margin: 0;
          padding: 0;
          flex: 1 1 auto;
          overflow-y: auto;
          max-height: calc(100vh - 180px);
        }
        @media (max-width: 700px) {
          #sidebar {
            min-width: 120px;
            width: 120px;
            font-size: 0.92em;
          }
          #sidebarCategories .sidebar-category {
            padding: 10px 8px;
            font-size: 0.95em;
          }
        }
        #sidebarSearchContainer {
          padding: 16px 12px 8px 12px;
          background: #23272e;
          border-bottom: 1px solid #181a1b;
        }
        #sidebarSearch {
          width: 100%;
          padding: 7px 10px;
          background: #181a1b;
          color: #e0e0e0;
          border: 1px solid #333;
          border-radius: 5px;
          font-size: 1em;
          outline: none;
          transition: border 0.2s;
        }
        #sidebarSearch:focus {
          border: 1.5px solid #4fc3f7;
        }
        #sidebarCategories {
          list-style: none;
          margin: 0;
          padding: 0;
          flex: 1 1 auto;
          overflow-y: auto;
        }
        .sidebar-category {
          padding: 12px 18px;
          color: #b5a045;
          font-weight: bold;
          cursor: pointer;
          border-left: 4px solid transparent;
          transition: background 0.15s, border-color 0.15s, color 0.15s;
          user-select: none;
        }
        .sidebar-category.selected, .sidebar-category:hover {
          background: #181a1b;
          border-left: 4px solid #4fc3f7;
          color: #4fc3f7;
        }
        #sidebarCodeMenu {
          padding: 10px 12px;
          background: #181a1b;
          border-top: 1px solid #23272e;
          min-height: 48px;
          color: #4fc3f7;
          font-size: 1.08em;
          display: flex;
          align-items: center;
          justify-content: flex-start;
        }
        #sidebarCodeMenu span {
          font-weight: bold;
        }
      </style>
    <div id="splashScreen" style="display: none !important; align-items: center; justify-content: center; position: fixed; top: 0; left: 0; width: 100vw; height: 100vh; background: #181a1b; z-index: 99999; transition: opacity 0.5s;">
      <div id="splashBox" style="background: #0a2e12; border-radius: 22px; box-shadow: 0 8px 48px #000b, 0 0 0 4px #39ff1460; padding: 38px 44px 28px 44px; min-width: 420px; max-width: 98vw; display: flex; flex-direction: column; align-items: center;">
        <div id="splashLogo" style="margin-bottom: 12px;">
          <img src="app_logo.png" alt="BF6Portal Tool Logo" style="width: 82px; height: 82px; border-radius: 16px; box-shadow: 0 2px 18px #000a;">
        </div>
        <div id="splashTitle" style="font-size: 2.3em; color: #b0ffb0; font-weight: bold; letter-spacing: 2px; text-shadow: 0 2px 8px #000a; margin-bottom: 6px;">BF6Portal Tool</div>
        <div id="splashCredits" style="color: #39ff14; font-size: 1.13em; margin-bottom: 8px; text-align: center;">
          Made by <span class="credit-name neuro-glitch">Neuro</span> &amp; <span class="credit-name ai-sparkle">Mostly A.I.</span><br>
          <span style="color:#baff80;">Special thanks: <span class="credit-name rainbow-andy">ANDY6170</span> &amp; <a href="https://discord.gg/z4PXNEsN" target="_blank" style="color:#4fc3f7;text-decoration:underline;">BattlefieldPortalHub</a></span>
        </div>
        <div id="splashError" style="color: #ffb300; font-size: 1.05em; text-align: center; margin-bottom: 8px;"></div>
        <div id="splashMsg" style="color: #4fc3f7; font-size: 1.1em; margin-bottom: 8px; text-align: center;"></div>
        <div id="splashWorking" style="margin-bottom: 8px;">
          <span class="splash-spinner" style="display:inline-block;width:32px;height:32px;vertical-align:middle;margin-right:8px;">
            <svg viewBox="0 0 50 50" style="width:32px;height:32px;"><circle cx="25" cy="25" r="20" fill="none" stroke="#4fc3f7" stroke-width="5" stroke-linecap="round" stroke-dasharray="31.4 31.4" transform="rotate(-90 25 25)"><animateTransform attributeName="transform" type="rotate" from="0 25 25" to="360 25 25" dur="1s" repeatCount="indefinite"/></circle></svg>
          </span>
          <span id="splashWorkingMsg" style="color:#baff80;font-size:1.08em;vertical-align:middle;max-width:320px;display:inline-block;"></span>
        </div>
        <div id="animatedLoadingBar" style="width: 100%; height: 8px; background: #003a10; border-radius: 4px; margin: 10px 0 8px 0; overflow: hidden; position: relative;">
          <div id="animatedLoadingBarAnim" style="position: absolute; left: 0; top: 0; height: 100%; width: 20%; background: linear-gradient(90deg, #39ff14 0%, #baff80 100%); box-shadow: 0 0 16px 4px #39ff1460;"></div>
          <!-- Notches for load state -->
          <div class="notch" id="notch1" style="position:absolute; left:12%; top:-4px; width:8px; height:16px; background:#baff80; border-radius:4px; opacity:0.4;"></div>
          <div class="notch" id="notch2" style="position:absolute; left:48%; top:-4px; width:8px; height:16px; background:#baff80; border-radius:4px; opacity:0.4;"></div>
          <div class="notch" id="notch3" style="position:absolute; left:84%; top:-4px; width:8px; height:16px; background:#baff80; border-radius:4px; opacity:0.4;"></div>
          <!-- Notch labels -->
          <div style="position:absolute; left:0; top:16px; width:100%; display:flex; justify-content:space-between; font-size:0.95em; color:#baff80; opacity:0.85; pointer-events:none;">
            <span style="margin-left:2%;">| booting</span>
            <span style="margin-left:-8px;">| loading Blocks</span>
            <span style="margin-right:2%;">| checking things work</span>
          </div>
        </div>
        <div id="splashTicker" style="width: 100%; color: #39ff14; font-size: 1.13em; text-align: center; margin-top: 2px; min-height: 1.5em; letter-spacing: 0.5px; background: #222; z-index: 2147483647; position: relative; border: 1px dashed #4fc3f7; font-weight: bold; text-shadow: 0 0 8px #39ff14, 0 0 16px #baff80;"></div>
      <div id="splashErrorFrame" style="width: 100%; color: #ffb300; background: #2a1a00; font-size: 1.05em; text-align: center; margin-top: 4px; min-height: 1.5em; border-radius: 4px; box-shadow: 0 2px 8px #0004; z-index: 100000;"></div>
      </div>
    </div>
              <style>
                                /* Diagnostics for animated loading bar */
                                #animatedLoadingBarAnim {
                                  background: linear-gradient(90deg, #39ff14 0%, #baff80 100%) !important;
                                  box-shadow: 0 0 16px 4px #39ff1460;
                                  min-width: 40px;
                                  border: 2px dashed #ffb300;
                                  animation: animatedLoadingBarMove 1.6s linear infinite;
                                }

                                @keyframes animatedLoadingBarMove {
                                  0% { left: 0; width: 20%; }
                                  50% { left: 80%; width: 20%; }
                                  100% { left: 0; width: 20%; }
                                }
                /* Neuro glitch effect */
                .neuro-glitch {
                  color: #39ff14;
                  font-weight: bold;
                  position: relative;
                  text-shadow: 0 0 2px #39ff14, 0 0 8px #39ff14, 0 0 2px #fff;
                  animation: neuroGlitch 1.2s infinite alternate;
                }
                @keyframes neuroGlitch {
                  0% { text-shadow: 0 0 2px #39ff14, 0 0 8px #39ff14, 0 0 2px #fff; }
                  50% { text-shadow: 2px 0 8px #baff80, -2px 0 8px #39ff14, 0 0 2px #fff; }
                  100% { text-shadow: 0 0 2px #39ff14, 0 0 8px #39ff14, 0 0 2px #fff; }
                }
                /* AI sparkles */
                .ai-sparkle {
                  color: #baff80;
                  font-weight: bold;
                  position: relative;
                  animation: aiSparkle 2.2s infinite linear;
                }
                @keyframes aiSparkle {
                  0%,100% { text-shadow: 0 0 6px #fff, 0 0 12px #baff80; }
                  50% { text-shadow: 0 0 16px #fff, 0 0 24px #baff80; }
                }
                /* Andy6170 rainbow */
                .rainbow-andy {
                  background: linear-gradient(90deg, #ff5252, #ffb300, #39ff14, #4fc3f7, #b388ff, #ff5252);
                  background-size: 400% 100%;
                  -webkit-background-clip: text;
                  -webkit-text-fill-color: transparent;
                  animation: rainbowAndy 2.5s linear infinite;
                  font-weight: bold;
                }
                @keyframes rainbowAndy {
                  0% { background-position: 0% 50%; }
                  100% { background-position: 100% 50%; }
                }
                /* Ticker is restored and cycles quirky comments every 12s before Blockly loads */
                /* (Animated loading bar is now controlled by JS, no animation keyframes needed) */
              </style>
            <style>
              #title {
                font-weight: bold;
                font-size: 20px;
                margin-right: 24px;
                color: #b0e0ff;
                letter-spacing: 1.5px;
                text-shadow: 0 1px 2px #000a;
                display: flex;
                align-items: center;
                position: relative;
              }
              #title:before {
                content: '';
                display: inline-block;
                width: 38px;
                height: 38px;
                margin-right: 12px;
                background: url('app_logo.png') no-repeat center/contain;
                border-radius: 7px;
                box-shadow: 0 2px 8px #000a;
                vertical-align: middle;
              }
            </style>
        <style>
          html, body {
            height: 100%;
            margin: 0;
            background: #181a1b;
            color: #e0e0e0;
            font-family: 'Segoe UI', 'Consolas', 'monospace', sans-serif;
            overflow: hidden;
          }
          #main {
            height: calc(100vh - 44px);
            overflow: hidden;
          }
          #editorContainer {
            height: 100%;

            #recenterBtn {
              top: 80px !important;
            }
          }
      .onboarding-modal {
        display: none;
        position: fixed;
        z-index: 2000;
        left: 0;
        top: 0;
        width: 100vw;
        height: 100vh;
        background: rgba(0,0,0,0.8);
        align-items: center;
        justify-content: center;
      }
      .onboarding-content {
        background: #23272e;
        color: #eee;
        padding: 32px 40px;
        border-radius: 12px;
        box-shadow: 0 4px 24px #000a;
        max-width: 480px;
        margin: auto;
        text-align: center;
      }
      .onboarding-content h2 {
        color: #4fc3f7;
        margin-bottom: 16px;
      }
      .onboarding-content ul {
        text-align: left;
        margin: 18px 0 24px 0;
        padding-left: 20px;
      }
      .onboarding-content button {
        background: #4fc3f7;
        color: #181a1b;
        border: none;

    <style>
      html, body {
        height: 100%;
        margin: 0;
        background: #181a1b;
        color: #e0e0e0;
        font-family: 'Segoe UI', 'Consolas', 'monospace', sans-serif;
        overflow: hidden;
      }
      #main {
        height: calc(100vh - 44px);
        overflow: hidden;
      }
      #editorContainer {
        height: 100%;
        overflow: hidden;
      }
      #blocklyDiv {
        height: 100%;
        width: 100%;
        overflow: hidden !important;
      }
      .onboarding-modal {
        display: none;
        position: fixed;
        z-index: 2000;
        left: 0;
        top: 0;
        width: 100vw;
        height: 100vh;
        background: rgba(0,0,0,0.8);
        align-items: center;
        justify-content: center;
      }
      .onboarding-content {
        background: #23272e;
        color: #eee;
        padding: 32px 40px;
        border-radius: 12px;
        box-shadow: 0 4px 24px #000a;
        max-width: 480px;
        margin: auto;
        text-align: center;
      }
      .onboarding-content h2 {
        color: #4fc3f7;
        margin-bottom: 16px;
      }
      .onboarding-content ul {
        text-align: left;
        margin: 18px 0 24px 0;
        padding-left: 20px;
      }
      .onboarding-content button {
        background: #4fc3f7;
        color: #181a1b;
        border: none;
        border-radius: 6px;
        padding: 10px 24px;
        font-size: 16px;
        font-weight: bold;
        cursor: pointer;
        margin-top: 12px;
      }
      /* Neon/animated styles for About modal names */
      .credit-name {
        color: #e0e0e0;
        font-weight: bold;
        font-size: 1.13em;
        letter-spacing: 0.04em;
        text-shadow: 0 1px 2px #000a;
      }
    </style>
  </head>

  <body>
    <!-- Live Diagnostics Console Overlay -->
    <div id="liveConsole" style="position:fixed;bottom:0;right:0;width:520px;max-width:98vw;height:180px;z-index:999999;background:#181a1be0;color:#baff80;font-family:monospace;font-size:0.98em;border-top-left-radius:10px;box-shadow:0 0 16px #000a;overflow-y:auto;display:none;flex-direction:column;">
      <div style="background:#23272e;padding:4px 12px;font-weight:bold;color:#4fc3f7;border-top-left-radius:10px;">Live Diagnostics Console <span id="liveConsoleToggle" style="float:right;cursor:pointer;color:#baff80;">[hide]</span></div>
      <div id="liveConsoleContent" style="flex:1 1 auto;padding:8px 12px;overflow-y:auto;max-height:140px;"></div>
    </div>
    <!-- Top menu bar (fixed, always on top) -->
    <div id="header">
      <button class="menu-btn" id="fileMenuBtn">File</button>
      <button class="menu-btn" id="editMenuBtn">Edit</button>
      <button class="menu-btn" id="viewMenuBtn">View</button>
      <button class="menu-btn" id="helpMenuBtn">Help</button>
      <span style="margin-left:24px;font-weight:bold;letter-spacing:1.5px;color:#4fc3f7;">BF6Portal Tool</span>
    </div>

    <!-- About Modal (fixed overlay, always on top) -->
    <div id="aboutModal" class="modal" style="display:none; position:fixed; z-index:4000; left:0; top:0; width:100vw; height:100vh; background:rgba(0,0,0,0.82); align-items:center; justify-content:center;">
      <div class="modal-content" style="max-width: 480px; margin:auto; background:#23272e; color:#fff; border-radius:14px; box-shadow:0 4px 32px #000a; padding:32px 32px 18px 32px; position:relative;">
        <span class="close" id="closeAboutModal" style="position:absolute;top:12px;right:18px;font-size:2em;cursor:pointer;">&times;</span>
        <h2>About BF6Portal Tool</h2>
        <div style="margin-bottom: 12px; font-size: 1.1em; color: #4fc3f7;">A modern, user-friendly block editor for Battlefield Portal scripting.</div>
        <div style="margin-bottom: 10px;">Author: <span class="neon-neuro">Neuro</span> <span style="font-size:1.13em;vertical-align:middle;"><span class="gemini-animated">&amp; Gemini Code</span><span class="mostly-playful">... Mostly :P</span></span></div>
        <div style="margin-bottom: 10px;">Contributors: <b><span class="rainbow-andy">ANDY6170</span></b> (special thanks!)</div>
        <div style="margin-bottom: 10px;">Tech: Blockly, JavaScript, Python, and a lot of coffee.</div>
        <div style="margin-bottom: 10px;">GitHub: <a href="https://github.com/neuro-1977/BF6Portal-Tool" target="_blank" style="color:#4fc3f7;">BF6Portal-Tool</a></div>
        <div style="margin: 18px 0 8px 0; font-size: 1.05em; color: #fff; text-align: center;">
          <span style="display:block; margin-bottom: 4px; letter-spacing:1px;">Made by</span>
          <span style="display:block;margin-top:8px;font-size:1.1em;">With thanks to <span class="rainbow-andy" id="andy-6170">ANDY6170</span> &amp; <a href="https://discord.gg/z4PXNEsN" target="_blank" style="color:#baff80;text-decoration:underline;">BattlefieldPortalHub</a> discord team.</span>
        </div>
      </div>
    </div>



    <div id="main" style="display: flex; height: calc(100vh - 44px);">
      <div id="sidebar" style="width: 260px; min-width: 220px; max-width: 320px; background: #23272e; border-right: 2px solid #181a1b; display: flex; flex-direction: column; z-index: 2; box-shadow: 2px 0 12px #000a;"></div>
      <div id="editorContainer" style="flex: 1; display: flex; flex-direction: column; min-height: 0; min-width: 0; background: #181a1b; overflow: hidden !important; position: relative;">
        <!-- Central error/status box -->
        <div id="errorBox" style="display:none; position:absolute; left:50%; top:50%; transform:translate(-50%,-50%); z-index:3000; min-width:340px; max-width:520px; background:#23272e; color:#fff; border:2px solid #4fc3f7; border-radius:14px; box-shadow:0 4px 32px #000a; padding:28px 32px 18px 32px; text-align:center; font-size:1.13em; font-family:'Segoe UI','Consolas',monospace,sans-serif;">
          <div id="errorBoxTitle" style="font-size:1.25em; font-weight:bold; color:#4fc3f7; margin-bottom:10px; letter-spacing:1.5px; text-shadow:0 2px 8px #000a;">PORTAL STATUS</div>
          <div id="errorBoxMessages" style="max-height:180px; overflow-y:auto; text-align:left; font-size:1em; line-height:1.5; margin-bottom:8px;"></div>
          <div id="errorBoxClose" style="margin-top:8px; color:#baff80; font-size:0.98em; cursor:pointer; text-decoration:underline; display:none;">Dismiss</div>
        </div>
        <div id="blocklyDiv" style="flex: 1 1 auto; min-height: 100px;"></div>
        <div id="dragDivider" style="height: 8px; background: #23272e; cursor: row-resize; display: none; align-items: center; justify-content: center; user-select: none;">
          <div style="width: 60px; height: 4px; background: #444; border-radius: 2px; margin: 2px auto;"></div>
        </div>
        <div id="codeDiv" style="display: none; height: 200px; background: #1e1e1e; border-top: 1px solid #333; padding: 10px; box-sizing: border-box;">
          <div style="color: #ccc; margin-bottom: 5px; font-size: 12px;">JSON Source View</div>
          <textarea id="codeOutput" style="width: 100%; height: calc(100% - 25px); background: #252526; color: #d4d4d4; border: 1px solid #333; font-family: monospace; resize: none;" readonly></textarea>
        </div>
      </div>
    </div>

    <!-- Help Modal -->
    <div id="helpModal" class="modal" style="display:none; position:fixed; z-index:4000; left:0; top:0; width:100vw; height:100vh; background:rgba(0,0,0,0.82); align-items:center; justify-content:center;">
      <div class="modal-content" style="max-width: 480px; margin:auto; background:#23272e; color:#fff; border-radius:14px; box-shadow:0 4px 32px #000a; padding:32px 32px 18px 32px; position:relative;">
        <span class="close" style="position:absolute;top:12px;right:18px;font-size:2em;cursor:pointer;">&times;</span>
        <h2 id="helpTitle">Block Help</h2>
        <div id="helpBody"></div>
      </div>
    </div>

    <script src="toolbox.js"></script>
    <!-- Blockly core, now loaded from vendor/blockly/ -->
    <script src="../blockly/blockly.min.js?v=20251128" id="blocklyScript" data-media="../blockly/media/"></script>
    <script src="definitions.js"></script>
    <script src="block_images.js"></script>
    <script src="main.js"></script>
    <script>
      // Live Diagnostics Console logic
      (function() {
        const liveConsole = document.getElementById('liveConsole');
        const liveConsoleContent = document.getElementById('liveConsoleContent');
        const liveConsoleToggle = document.getElementById('liveConsoleToggle');
        const splashErrorFrame = document.getElementById('splashErrorFrame');
        let liveConsoleVisible = false;
        let logBuffer = [];
        function showLiveConsole() {
          if (liveConsole) {
            liveConsole.style.display = 'flex';
            liveConsoleVisible = true;
          }
        }
        function hideLiveConsole() {
          if (liveConsole) {
            liveConsole.style.display = 'none';
            liveConsoleVisible = false;
          }
        }
        if (liveConsoleToggle) {
          liveConsoleToggle.onclick = function() {
            if (liveConsoleVisible) hideLiveConsole(); else showLiveConsole();
          };
        }
        // Expose to window for debugging
        window.showLiveConsole = showLiveConsole;
        window.hideLiveConsole = hideLiveConsole;
        // Patch console.log/warn/error
        const origLog = console.log, origWarn = console.warn, origErr = console.error;
        function appendToConsole(msg, type) {
          if (!liveConsoleContent) return;
          const el = document.createElement('div');
          el.textContent = `[${type}] ${msg}`;
          el.style.color = type === 'error' ? '#ffb300' : (type === 'warn' ? '#ffb300' : '#baff80');
          liveConsoleContent.appendChild(el);
          liveConsoleContent.scrollTop = liveConsoleContent.scrollHeight;
          // Add to buffer for splashErrorFrame
          logBuffer.push({msg, type});
          if (logBuffer.length > 20) logBuffer.shift();
          updateSplashErrorFrame();
        }
        function updateSplashErrorFrame() {
          if (!splashErrorFrame) return;
          // Show last 10 lines, tiny font
          let lines = logBuffer.slice(-10).map(l => `<div style='font-size:10px;line-height:1.2;color:${l.type==='error'||l.type==='warn'?'#ffb300':'#baff80'};'>[${l.type}] ${l.msg}</div>`).join('');
          splashErrorFrame.innerHTML = lines;
        }
        console.log = function(...args) {
          origLog.apply(console, args);
          appendToConsole(args.join(' '), 'log');
        };
        console.warn = function(...args) {
          origWarn.apply(console, args);
          appendToConsole(args.join(' '), 'warn');
        };
        console.error = function(...args) {
          origErr.apply(console, args);
          appendToConsole(args.join(' '), 'error');
        };
        // Show console on error automatically
        window.addEventListener('error', function(e) {
          showLiveConsole();
        });
        // Show console on demand (F8)
        window.addEventListener('keydown', function(e) {
          if (e.key === 'F8') {
            if (liveConsoleVisible) hideLiveConsole(); else showLiveConsole();
          }
        });
        // Show by default for now
        showLiveConsole();
        // Initial update for splashErrorFrame
        updateSplashErrorFrame();
      })();
    </script>
    <script>
      // Example: Hook up menu buttons (expand as needed)
      document.getElementById('fileMenuBtn').onclick = function() {
        alert('File menu coming soon!');
      };
      document.getElementById('editMenuBtn').onclick = function() {
        alert('Edit menu coming soon!');
      };
      document.getElementById('viewMenuBtn').onclick = function() {
        alert('View menu coming soon!');
      };
      document.getElementById('helpMenuBtn').onclick = function() {
        alert('Help menu coming soon!');
      };
    </script>
  </body>
      color: #aaa;
      float: right;
      font-size: 28px;
      font-weight: bold;
      cursor: pointer;
    }
    .close:hover,
    .close:focus {
      color: #fff;
      text-decoration: none;
      cursor: pointer;
    }
    .help-image {
      max-width: 100%;
      height: auto;
      margin-top: 10px;
      border: 1px solid #555;
    }
    .help-section {
      margin-bottom: 15px;
    }
    .help-section h3 {
      border-bottom: 1px solid #555;
      padding-bottom: 5px;
      margin-bottom: 10px;
      color: #4fc3f7;
    }
  </style>
</head>
  <body>
  <div id="header">
    <div id="title">BF6Portal Tool</div>
    <!-- Logo is handled by #title:before CSS, ensure app_logo.png is present -->
    <button id="aboutBtn" style="padding: 6px 12px; background: #23272e; color: #fff; border: 1px solid #4fc3f7; border-radius: 4px; cursor: pointer; font-weight: bold; margin-left: 18px;">About</button>

    <div style="flex: 1; display: flex; gap: 10px; align-items: center;">
      <button id="healthCheckBtn" style="padding: 6px 12px; background: #4fc3f7; color: #181a1b; border: none; border-radius: 4px; cursor: pointer; font-weight: bold;">Health Check</button>
        <!-- Health Check Modal -->
        <div id="healthModal" class="modal" style="display:none; position:fixed; z-index:4000; left:0; top:0; width:100vw; height:100vh; background:rgba(0,0,0,0.82); align-items:center; justify-content:center;">
          <div class="modal-content" style="max-width: 480px; margin:auto; background:#23272e; color:#fff; border-radius:14px; box-shadow:0 4px 32px #000a; padding:32px 32px 18px 32px; position:relative;">
            <span class="close" id="closeHealthModal" style="position:absolute;top:12px;right:18px;font-size:2em;cursor:pointer;">&times;</span>
            <h2>System Health Check</h2>
            <div id="healthBody"></div>
          </div>
        </div>
      <button id="saveBtn" style="padding: 6px 12px; background: #007acc; color: white; border: none; border-radius: 4px; cursor: pointer;">Save</button>
      <button id="importHelpBtn" style="padding: 6px 12px; background: #ffb300; color: #181a1b; border: none; border-radius: 4px; cursor: pointer; font-weight: bold; display: none;">Import Help</button>
        <!-- Import Help Modal -->
        <div id="importHelpModal" class="modal" style="display:none; position:fixed; z-index:4000; left:0; top:0; width:100vw; height:100vh; background:rgba(0,0,0,0.82); align-items:center; justify-content:center;">
          <div class="modal-content" style="max-width: 480px; margin:auto; background:#23272e; color:#fff; border-radius:14px; box-shadow:0 4px 32px #000a; padding:32px 32px 18px 32px; position:relative;">
            <span class="close" id="closeImportHelpModal" style="position:absolute;top:12px;right:18px;font-size:2em;cursor:pointer;">&times;</span>
            <h2>Import Help &amp; Issues</h2>
            <div id="importHelpBody"></div>
          </div>
        </div>
      <button id="loadBtn" style="padding: 6px 12px; background: #333; color: white; border: 1px solid #555; border-radius: 4px; cursor: pointer;">Load</button>
      <button id="codeBtn" style="padding: 6px 12px; background: #333; color: white; border: 1px solid #555; border-radius: 4px; cursor: pointer;">Code</button>
      <button id="exportTsBtn" style="padding: 6px 12px; background: #4fc3f7; color: #181a1b; border: none; border-radius: 4px; cursor: pointer; font-weight: bold;">Export .ts</button>
      <input type="file" id="loadInput" style="display: none;" accept=".json">
      <input type="file" id="tscnInput" style="display: none;" accept=".tscn">
      <button id="importTscnBtn" style="padding: 6px 12px; background: #4fc3f7; color: #181a1b; border: none; border-radius: 4px; cursor: pointer; font-weight: bold;">Import .tscn</button>
      <div id="zoomContainer" style="margin-left: 24px; display: flex; align-items: center;">
        <label for="zoomSlider" style="color: #aaa; font-size: 13px; margin-right: 6px;">Zoom</label>
        <div style="position: relative; width: 110px; height: 18px; display: flex; align-items: center;">
          <input type="range" id="zoomSlider" min="30" max="300" value="75" style="width: 100%; background: transparent; appearance: none; -webkit-appearance: none; height: 4px; border-radius: 2px; background: #333; outline: none; margin: 0; padding: 0;">
          <style>
            #zoomSlider::-webkit-slider-thumb {
              -webkit-appearance: none;
              appearance: none;
              width: 16px;
              height: 16px;
              border-radius: 50%;
              background: #4fc3f7;
              border: 2px solid #23272e;
              cursor: pointer;
              box-shadow: 0 2px 6px #0006;
              transition: background 0.2s;
            }
            #zoomSlider::-moz-range-thumb {
              width: 16px;
              height: 16px;
              border-radius: 50%;
              background: #4fc3f7;
              border: 2px solid #23272e;
              cursor: pointer;
              box-shadow: 0 2px 6px #0006;
              transition: background 0.2s;
            }
            #zoomSlider::-ms-thumb {
              width: 16px;
              height: 16px;
              border-radius: 50%;
              background: #4fc3f7;
              border: 2px solid #23272e;
              cursor: pointer;
              box-shadow: 0 2px 6px #0006;
              transition: background 0.2s;
            }
            #zoomSlider::-webkit-slider-runnable-track {
              height: 4px;
              border-radius: 2px;
              background: #333;
            }
            #zoomSlider::-ms-fill-lower, #zoomSlider::-ms-fill-upper {
              background: #333;
            }
            #zoomSlider:focus {
              outline: none;
            }
          </style>
        </div>
        <span id="zoomValue" style="color: #aaa; font-size: 13px; margin-left: 6px;">75%</span>
      </div>
    </div>
    <!-- Search bar will be injected into the toolbox/sidebar by JS -->
  </div>

    <!-- Floating recenter (compass) button -->
    <button id="recenterBtn" title="Recenter Workspace" style="position: absolute; left: 50%; top: 76px; transform: translateX(-50%); z-index: 9999; background: #23272e; border: 2.5px solid #888; border-radius: 50%; width: 44px; height: 44px; display: flex; align-items: center; justify-content: center; box-shadow: 0 2px 8px #000a; cursor: pointer; transition: background 0.2s; margin-top: 4px;">
      <svg width="32" height="32" viewBox="0 0 32 32" fill="none" xmlns="http://www.w3.org/2000/svg">
        <circle cx="16" cy="16" r="15" stroke="#aaa" stroke-width="2.5" fill="#23272e"/>
        <line x1="16" y1="4" x2="16" y2="28" stroke="#aaa" stroke-width="2"/>
        <line x1="4" y1="16" x2="28" y2="16" stroke="#aaa" stroke-width="2"/>
      </svg>
    </button>


  <!-- Main layout: sidebar (fixed left), editor container (fills rest) -->
  <div id="main" style="display: flex; height: 100vh; padding-top: 48px;">
    <!-- Sidebar: left-aligned, fixed, with search, categories, and code menu -->
    <nav id="sidebar">
      <!-- Search bar (to be wired up) -->
      <div id="sidebarSearchContainer" style="padding: 16px 12px 8px 12px; background: #23272e; border-bottom: 1px solid #181a1b;">
        <input id="sidebarSearch" type="text" placeholder="Search..." style="width: 100%; padding: 7px 10px; background: #181a1b; color: #e0e0e0; border: 1px solid #333; border-radius: 5px; font-size: 1em; outline: none;" />
      </div>
      <!-- Category list -->
      <ul id="sidebarCategories" style="list-style: none; margin: 0; padding: 0; flex: 1 1 auto; overflow-y: auto;">
        <!-- JS will populate categories here -->
        <li class="sidebar-category" style="padding: 12px 18px; color: #a285e6; font-weight: bold; cursor: pointer; border-left: 4px solid transparent; display: flex; align-items: center;"><span style='margin-right:8px;'>üü™</span>RULES</li>
        <li class="sidebar-category" style="padding: 12px 18px; color: #45b5b5; font-weight: bold; cursor: pointer; border-left: 4px solid transparent; display: flex; align-items: center;"><span style='margin-right:8px;'>üü¶</span>CONDITIONS</li>
        <li class="sidebar-category" style="padding: 12px 18px; color: #e6a85c; font-weight: bold; cursor: pointer; border-left: 4px solid transparent; display: flex; align-items: center;"><span style='margin-right:8px;'>üü´</span>SUBROUTINES</li>
        <li class="sidebar-category" style="padding: 12px 18px; color: #b5a045; font-weight: bold; cursor: pointer; border-left: 4px solid transparent; display: flex; align-items: center;"><span style='margin-right:8px;'>üü®</span>AI</li>
        <li class="sidebar-category" style="padding: 12px 18px; color: #b5a045; font-weight: bold; cursor: pointer; border-left: 4px solid transparent; display: flex; align-items: center;"><span style='margin-right:8px;'>üü®</span>ARRAYS</li>
        <li class="sidebar-category" style="padding: 12px 18px; color: #b5a045; font-weight: bold; cursor: pointer; border-left: 4px solid transparent; display: flex; align-items: center;"><span style='margin-right:8px;'>üü®</span>AUDIO</li>
        <li class="sidebar-category" style="padding: 12px 18px; color: #b5a045; font-weight: bold; cursor: pointer; border-left: 4px solid transparent; display: flex; align-items: center;"><span style='margin-right:8px;'>üü®</span>CAMERA</li>
        <li class="sidebar-category" style="padding: 12px 18px; color: #b5a045; font-weight: bold; cursor: pointer; border-left: 4px solid transparent; display: flex; align-items: center;"><span style='margin-right:8px;'>üü®</span>EFFECTS</li>
        <li class="sidebar-category" style="padding: 12px 18px; color: #b5a045; font-weight: bold; cursor: pointer; border-left: 4px solid transparent; display: flex; align-items: center;"><span style='margin-right:8px;'>üü®</span>EMPLACEMENTS</li>
        <li class="sidebar-category" style="padding: 12px 18px; color: #b5a045; font-weight: bold; cursor: pointer; border-left: 4px solid transparent; display: flex; align-items: center;"><span style='margin-right:8px;'>üü®</span>GAMEPLAY</li>
        <li class="sidebar-category" style="padding: 12px 18px; color: #b5a045; font-weight: bold; cursor: pointer; border-left: 4px solid transparent; display: flex; align-items: center;"><span style='margin-right:8px;'>üü®</span>LOGIC</li>
        <li class="sidebar-category" style="padding: 12px 18px; color: #b5a045; font-weight: bold; cursor: pointer; border-left: 4px solid transparent; display: flex; align-items: center;"><span style='margin-right:8px;'>üü®</span>OBJECTIVE</li>
        <li class="sidebar-category" style="padding: 12px 18px; color: #b5a045; font-weight: bold; cursor: pointer; border-left: 4px solid transparent; display: flex; align-items: center;"><span style='margin-right:8px;'>üü®</span>OTHER</li>
        <li class="sidebar-category" style="padding: 12px 18px; color: #b5a045; font-weight: bold; cursor: pointer; border-left: 4px solid transparent; display: flex; align-items: center;"><span style='margin-right:8px;'>üü®</span>PLAYER</li>
        <li class="sidebar-category" style="padding: 12px 18px; color: #b5a045; font-weight: bold; cursor: pointer; border-left: 4px solid transparent; display: flex; align-items: center;"><span style='margin-right:8px;'>üü®</span>TRANSFORM</li>
        <li class="sidebar-category" style="padding: 12px 18px; color: #b5a045; font-weight: bold; cursor: pointer; border-left: 4px solid transparent; display: flex; align-items: center;"><span style='margin-right:8px;'>üü®</span>UI</li>
        <li class="sidebar-category" style="padding: 12px 18px; color: #b5a045; font-weight: bold; cursor: pointer; border-left: 4px solid transparent; display: flex; align-items: center;"><span style='margin-right:8px;'>üü®</span>VEHICLES</li>
      </ul>
      <!-- Code menu at bottom (placeholder) -->
      <div id="sidebarCodeMenu" style="padding: 10px 12px; background: #181a1b; border-top: 1px solid #23272e; min-height: 48px; color: #4fc3f7; font-size: 1.08em; display: flex; align-items: center; gap: 12px;">
        <button class="sidebar-code-btn" title="Export" style="background: none; border: none; color: #4fc3f7; font-size: 1.2em; cursor: pointer; padding: 4px 8px; border-radius: 5px; transition: background 0.15s;"><span style="font-size:1.2em;">‚≠≥</span></button>
        <button class="sidebar-code-btn" title="Import" style="background: none; border: none; color: #4fc3f7; font-size: 1.2em; cursor: pointer; padding: 4px 8px; border-radius: 5px; transition: background 0.15s;"><span style="font-size:1.2em;">‚≠±</span></button>
        <button class="sidebar-code-btn" title="Settings" style="background: none; border: none; color: #4fc3f7; font-size: 1.2em; cursor: pointer; padding: 4px 8px; border-radius: 5px; transition: background 0.15s;"><span style="font-size:1.2em;">‚öôÔ∏è</span></button>
      </div>
    </nav>
    <!-- Editor container: blockly canvas, code view, drag divider -->
    <div id="editorContainer" style="flex: 1; display: flex; flex-direction: column; min-height: 0; min-width: 0; background: #181a1b; overflow: hidden !important; margin-left: 260px;">
      <div id="blocklyDiv" style="flex: 1 1 auto; min-height: 100px;"></div>
      <div id="dragDivider" style="height: 8px; background: #23272e; cursor: row-resize; display: none; align-items: center; justify-content: center; user-select: none;">
        <div style="width: 60px; height: 4px; background: #444; border-radius: 2px; margin: 2px auto;"></div>
      </div>
      <div id="codeDiv" style="display: none; height: 200px; background: #1e1e1e; border-top: 1px solid #333; padding: 10px; box-sizing: border-box;">
        <div style="color: #ccc; margin-bottom: 5px; font-size: 12px;">JSON Source View</div>
        <textarea id="codeOutput" style="width: 100%; height: calc(100% - 25px); background: #252526; color: #d4d4d4; border: 1px solid #333; font-family: monospace; resize: none;" readonly></textarea>
      </div>
    </div>
  </div>

  <!-- Help Modal (fixed overlay, always on top) -->
  <div id="helpModal" class="modal">
    <div class="modal-content">
      <span class="close">&times;</span>
      <h2 id="helpTitle">Block Help</h2>
      <div id="helpBody"></div>
    </div>
  </div>
  <script src="toolbox.js"></script>
    <script>
      // Print all script tags before Blockly loads
      console.log('[DIAG] Script tags BEFORE Blockly:');
      Array.from(document.getElementsByTagName('script')).forEach(s => {
        console.log('[DIAG] Script:', s.src || '[inline]', 'type:', s.type || '[none]');
      });
    </script>
    <script>
      // Dynamically load Blockly with robust diagnostics
      (function() {
        var script = document.createElement('script');
        script.src = '../vendor/blockly/blockly.min.js?v=20251128';
        script.id = 'blocklyScript';
        script.async = false;
        script.onload = function() {
          console.log('[DIAG] Blockly script onload fired');
          // Print all window keys for debugging
          try {
            var winKeys = Object.keys(window).sort();
            console.log('[DIAG] window keys:', winKeys.join(','));
          } catch (e) {
            console.warn('[DIAG] Could not enumerate window keys:', e);
          }
          // Check MIME type by fetching script
          fetch(script.src.split('?')[0], {method:'GET'}).then(resp => {
            console.log('[DIAG] blockly.min.js MIME type:', resp.headers.get('content-type'));
            return resp.text();
          }).then(txt => {
            console.log('[DIAG] blockly.min.js first 200 chars:', txt.slice(0,200));
          }).catch(e => {
            console.warn('[DIAG] Could not fetch blockly.min.js:', e);
          });
          setTimeout(function() {
            console.log('[DIAG] typeof Blockly after script onload:', typeof Blockly);
            if (typeof Blockly === 'undefined') {
              if (typeof showErrorBox === 'function') {
                showErrorBox('Critical Error', '[DIAG] Blockly is undefined after script onload!', false);
              }
              const splashErrorFrame = document.getElementById('splashErrorFrame');
              if (splashErrorFrame) {
                splashErrorFrame.innerHTML = '[DIAG] Blockly is undefined after script onload!';
              }
              document.body.insertAdjacentHTML('afterbegin', '<div style="position:fixed;top:0;left:0;width:100vw;height:40px;background:#c00;color:#fff;z-index:9999999;font-size:18px;text-align:center;line-height:40px;">[DIAG] Blockly is undefined after script onload!</div>');
            } else {
              console.log('[DIAG] Blockly loaded successfully!');
            }
          }, 0);
        };
        script.onerror = function(e) {
          console.error('[DIAG] Blockly script failed to load:', e);
          if (typeof showErrorBox === 'function') {
            showErrorBox('Critical Error', '[DIAG] blockly.min.js failed to load!', false);
          }
          const splashErrorFrame = document.getElementById('splashErrorFrame');
          if (splashErrorFrame) {
            splashErrorFrame.innerHTML = '[DIAG] blockly.min.js failed to load!';
          }
          document.body.insertAdjacentHTML('afterbegin', '<div style="position:fixed;top:0;left:0;width:100vw;height:40px;background:#c00;color:#fff;z-index:9999999;font-size:18px;text-align:center;line-height:40px;">[DIAG] blockly.min.js failed to load!</div>');
        };
        script.onreadystatechange = function() {
          console.log('[DIAG] Blockly script readyState:', script.readyState);
        };
        document.head.appendChild(script);
      })();
    </script>
    <script>
      console.log('[DIAG] Blockly script loaded');
      console.log('[DIAG] typeof Blockly after script:', typeof Blockly);
      if (typeof Blockly === 'undefined') {
        document.body.insertAdjacentHTML('afterbegin', '<div style="position:fixed;top:0;left:0;width:100vw;height:40px;background:#c00;color:#fff;z-index:9999999;font-size:18px;text-align:center;line-height:40px;">[DIAG] Blockly is undefined after script load!</div>');
      }
    </script>
    <script>
      // Add error handler for Blockly script
      document.getElementById('blocklyScript').onerror = function(e) {
        const splash = document.getElementById('splashScreen');
        if (splash) {
          splash.style.opacity = '1';
          splash.style.display = 'flex';
          const splashMsg = document.getElementById('splashMsg');
          const splashError = document.getElementById('splashError');
          if (splashMsg) splashMsg.innerHTML = '';
          if (splashError) splashError.innerHTML = `<div style=\"font-size:1.15em;margin-bottom:6px;\">Critical Error: <b>blockly.min.js</b> failed to load.</div><div style='margin-bottom:2px;'>üõ†Ô∏è <span style='color:#fff;'>The core editor could not be initialized.<br>Check that <b>blockly.min.js</b> is present and not blocked by browser or server.<br><br><b>Script load error:</b> ${e.message || e.type}</span></div><div style='margin-top:8px;font-size:0.95em;color:#baff80;'>If this persists, please contact support with a screenshot.</div>`;
        }
        // Also log to console
        console.error('Failed to load blockly.min.js', e);
      };
    </script>
  <script src="definitions.js"></script>
  <script src="block_images.js"></script>
  <script src="main.js"></script>
</body>
</html>
