<!doctype html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Serenity</title>
    <!-- <link rel="icon" type="image/png" href="public/favicon.ico"> -->
    <!-- <link rel="icon" type="image/png" href="public/favicon.ico"> -->
    <!-- <link rel="preload" href="public/serenity_logo_small.png" as="image"> -->
    <!-- <link rel="preload" href="public/serenity_logo.png" as="image"> -->
    <!-- <link rel="preload" href="public/Serenity.ttf" as="font" type="font/ttf" crossorigin> -->
    <style>
      @font-face {
        font-family: 'SerenityFirefly';
        src: url('public/Serenity.ttf') format('truetype'),
             url('public/088138b8ed4beb8280b23ba7e9fd7d55.woff2') format('woff2'),
             url('public/088138b8ed4beb8280b23ba7e9fd7d55.ttf') format('truetype'),
             url('public/088138b8ed4beb8280b23ba7e9fd7d55.eot') format('embedded-opentype');
        font-weight: normal;
        font-style: normal;
        font-display: swap;
      }
    </style>
        <style id="serenity-align-patch">
          /* Force toolbox/menu popout further right */
          .blocklyToolboxDiv { left: 32px !important; }
        </style>
    <style>
      body {
        font-family: sans-serif;
        background-color: #121212;
        color: white;
        margin: 0;
      }
      
      /* Modal Styles */
      .modal {
        display: none; 
        position: fixed; 
        z-index: 1000; 
        left: 0;
        top: 0;
        width: 100%; 
        height: 100%; 
        overflow: auto; 
        background-color: rgba(0,0,0,0.4); 
      }
      .modal-content {
        background-color: #2d2d2d;
        margin: 15% auto; 
        padding: 20px;
        border: 1px solid #888;
        width: 50%; 
        color: #fff;
        border-radius: 8px;
      }
      .close {
        color: #aaa;
        float: right;
        font-size: 28px;
        font-weight: bold;
      }
      .close:hover,
      .close:focus {
        color: #fff;
        text-decoration: none;
        cursor: pointer;
      }
      .param-row {
        display: flex;
        gap: 10px;
        margin-bottom: 10px;
      }
      .param-row input, .param-row select {
        padding: 5px;
        background: #444;
        color: white;
        border: 1px solid #666;
      }
      #addParamBtn, #createSubBtn {
        padding: 8px 16px;
        background: #E65100;
        color: white;
        border: none;
        cursor: pointer;
        margin-top: 10px;
      }

      #container {
        display: flex;
        height: 100vh;
      }
      #blocklyDiv {
        flex-grow: 1;
        height: 100%;
        width: 70%;
      }
      #outputPane {
        width: 30%;
        height: 100%;
        background-color: #1e1e1e;
        padding: 10px;
        display: flex;
        flex-direction: column;
        box-sizing: border-box;
      }
      #generatedCode {
        flex-grow: 1;
        background-color: #12121e;
        color: white;
        border: none;
        padding: 10px;
        overflow: auto;
        white-space: pre-wrap;
      }
      .blocklyGrid .blocklyGridLine {
        stroke: #555;
      }
      .dropdown { position: relative; }
      .dropdown-toggle { cursor: pointer; }
      .dropdown-menu {
        display: none;
        position: absolute;
        left: 100%;
        top: 0;
        background: #23272e;
        min-width: 180px;
        z-index: 10;
        border-radius: 6px;
        box-shadow: 0 2px 8px #0008;
        padding: 8px 0;
      }
      .dropdown:hover > .dropdown-menu,
      .dropdown:focus-within > .dropdown-menu {
        display: block;
        left: 0;
        top: 100%;
      }
      .dropdown-sub { position: relative; }
      .dropdown-sub > span {
        display: block;
        padding: 10px 20px;
        color: #F9A825;
        font-weight: bold;
        cursor: pointer;
      }
      .dropdown-sub > .dropdown-menu {
        left: 100%;
        top: 0;
        display: none;
      }
      .dropdown-sub:hover > .dropdown-menu,
      .dropdown-sub:focus-within > .dropdown-menu {
        display: block;
      }
      .dropdown-menu a {
        color: #90caf9;
        padding: 10px 20px;
        display: block;
        text-decoration: none;
        border-radius: 4px;
      }
      .dropdown-menu a:hover {
        background: #2a2d2e;
      }
    </style>
</head>
<body>
<div id="globalError" style="display:none; position:fixed; top:0; left:0; width:100%; background:red; color:white; padding:20px; z-index:99999; white-space:pre-wrap;"></div>
<script>
  window.onerror = function(msg, url, line, col, error) {
    var div = document.getElementById('globalError');
    div.style.display = 'block';
    div.innerText = 'CRITICAL ERROR:\n' + msg + '\n' + url + ':' + line + ':' + col + '\n' + (error ? error.stack : '');
  };
</script>
<div id="menuBarContainer"></div><div id="searchBarContainer" style="width: 250px; margin-left: 32px; padding: 5px; background-color: #1e1e1e; box-sizing: border-box;"><input id="blocklySearchInput" placeholder="Search blocks..." style="width: 100%; padding: 5px; border: 1px solid #333; background-color: #2a2a2a; color: white;"></div><div id="container">
        <div id="blocklyDiv"></div>
        <div id="outputPane">
          <pre id="generatedCode"></pre>
        </div>
        </div>
        <!-- Subroutine Modal -->
        <div id="subroutineModal" class="modal">
          <div class="modal-content">
            <span class="close">&times;</span>
            <h2>Create New Subroutine</h2>
            <div style="margin-bottom: 15px;">
              <label>Subroutine Name:</label>
              <input type="text" id="subNameInput" style="width: 100%; padding: 5px; margin-top: 5px; background: #444; color: white; border: 1px solid #666;">
            </div>
            
            <h3>Parameters</h3>
            <div id="paramsContainer">
              <!-- Param rows will go here -->
            </div>
            
            <button id="addParamBtn">Add Parameter</button>
            <br><br>
            <button id="createSubBtn">Create Subroutine</button>
          </div>
        </div>
            
      </body>
      </html>